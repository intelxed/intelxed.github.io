<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XED-BUILD: XED Build Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XED-BUILD
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">XED Build Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>by Mark Charney</p>
<p>2019-02-04</p>
<h1><a class="anchor" id="INTRO"></a>
Introduction</h1>
<p>XED can build with many compilers:</p><ul>
<li>GNU GCC</li>
<li>Microsoft Visual Studio</li>
<li>Intel ICL/ICC</li>
<li>LLVM/Clang</li>
</ul>
<p>XED also works with the following operating systems:</p><ul>
<li>Linux</li>
<li>Microsoft Windows (with or without cygwin)</li>
<li>Apple Mac OS/X</li>
<li>FreeBSD</li>
</ul>
<p>The default compiler on Linux and FreeBSD is GNU gcc. The default on Windows is to use MSVS. The default compiler on OS X is clang.</p>
<p>The build system uses the compilers from your PATH by default. You can override this with various command line options.</p>
<p>Table of Contents</p><ul>
<li><a class="el" href="index.html#REPOS">REPOS</a> Repository access</li>
<li><a class="el" href="index.html#MBUILD">MBUILD</a> Using mbuild to build XED</li>
<li><a class="el" href="index.html#INSTALL">INSTALL</a> Making XED kits</li>
<li><a class="el" href="index.html#WINDOWS">WINDOWS</a> Windows notes</li>
<li><a class="el" href="index.html#SHARED">SHARED</a> Shared libraries and DLLs</li>
<li><a class="el" href="index.html#HELP">HELP</a> The mbuild options</li>
</ul>
<h1><a class="anchor" id="REPOS"></a>
Repository Access</h1>
<p>XED is stored in an GIT repository. Request access from me if you want to build XED.</p>
<p>Here's how to check out XED and mbuild, as sibling directories:</p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/intelxed/xed.git xed</span></div><div class="line">git clone https:<span class="comment">//github.com/intelxed/mbuild.git mbuild</span></div></div><!-- fragment --><p>If you are working in a directory called foo, then after the clones, your trees should look like this: </p><div class="fragment"><div class="line">    |-mbuild-|-mbuild----</div><div class="line">foo-|        |-tests-----</div><div class="line">    |        </div><div class="line">    |-xed----|-datafiles-|-avx--------</div><div class="line">             |           |-avxivb-----</div><div class="line">             |           |-avxhsw-----</div><div class="line">             |-docsrc----</div><div class="line">             |-enumer.d--</div><div class="line">             |-examples--</div><div class="line">             |</div><div class="line">             |-include---|-<span class="keyword">private</span>----</div><div class="line">             |           |-<span class="keyword">public</span>-----</div><div class="line">             |-misc------</div><div class="line">             |-scripts---</div><div class="line">             |</div><div class="line">             |-tests-----|-test-00000-</div><div class="line">             |           |-test-00001-</div><div class="line"></div><div class="line">           ... </div><div class="line"></div><div class="line">             |           |-test-00147-</div><div class="line">             |-use-------</div></div><!-- fragment --><h1><a class="anchor" id="MBUILD"></a>
Introduction to using mbuild</h1>
<p>Mbuild is a python-based build system. For more information about mbuild see: <a href="https://intelxed.github.io">https://intelxed.github.io</a> (or inside Intel <a href="http://mjc.intel.com/mjcharne/mbuild">http://mjc.intel.com/mjcharne/mbuild</a> ).</p>
<p>The XED build using mbuild is dependence driven It uses file and command signatures to detect the need to rebuild files.</p>
<p>The mbuild script requires python version 2.7, python 3.4 or later.</p>
<p>Assuming you checked out the tree as described above, you can build XED using mbuild as follows on linux: </p><div class="fragment"><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">../xed/mfile.py</div><div class="line">../xed/mfile.py examples       (optional)</div><div class="line">../xed/mfile.py doc            (optional, requires doxygen)</div><div class="line">../xed/mfile.py doc-build      (optional, requires doxygen)</div><div class="line">../xed/mfile.py install        (optional)</div><div class="line">../xed/mfile.py install zip    (optional, makes a zip file)</div><div class="line">../xed/mfile.py examples install zip    (optional, makes a zip file that includes the examples)</div></div><!-- fragment --><p>Actual windows example (password prompts omitted):</p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/intelxed/xed.git xed</span></div><div class="line">git clone https:<span class="comment">//github.com/intelxed/mbuild.git mbuild</span></div><div class="line">mkdir test</div><div class="line">cd test</div><div class="line">C:/Python27/python ../xed/mfile.py examples install zip</div></div><!-- fragment --><p>For more information on building for windows see section <a class="el" href="index.html#WINDOWS">Windows notes</a></p>
<p>Actual linux example (password prompts omitted):</p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/intelxed/xed.git xed</span></div><div class="line">git clone https:<span class="comment">//github.com/intelxed/mbuild.git mbuild</span></div><div class="line">mkdir test</div><div class="line">cd test</div><div class="line">python ../xed/mfile.py examples install zip</div></div><!-- fragment --><p>To build 32b on a 64b platform, add to the mfile.py execution "host_cpu=ia32": </p><div class="fragment"><div class="line">C:/Python27/python ../xed/mfile.py examples install zip host_cpu=ia32</div></div><!-- fragment --><h1><a class="anchor" id="INSTALL"></a>
Making XED kits</h1>
<p>Some of the headers are private (for building XED), some are public and some are generated. To simplify use, I recommend that all users work from XED kits, rather from the XED sources. This section describes how to build XED kits using the "install" target.</p>
<p>The install target collects up all pieces and puts them in one subdirectory. The static public headers and dynamically generated public header files are put in an "include" subdirectory.</p>
<p>Static libraries are put the "lib" directory. If you are doing a shared object or DLL build, the shared object or DLL is put in the bin directory. This simplifies using the examples.</p>
<p>The manual and examples, if generated, are also included in doc directory.</p>
<p>The structure of a XED kit is as follows: </p><div class="fragment"><div class="line">                |-bin------</div><div class="line">                |-doc------|-html-</div><div class="line">                |-examples-</div><div class="line">|-xed-kit-name--|-include--</div><div class="line">                |-lib------</div><div class="line">                |-misc-----</div></div><!-- fragment --><p>You can also combine the various targets in one invocation. It will be quicker than the sequence of commands. </p><div class="fragment"><div class="line">../xed/mfile.py doc doc-build examples install   </div></div><!-- fragment --><h1><a class="anchor" id="WINDOWS"></a>
Windows notes</h1>
<p>For building on windows, the easiest build method assumes that you've configured your environment by running the appropriate BAT file, such as vcvars32.bat or vcvarsamd64.bat from the bin directory of your MSVS installation, by opening a Visual Studio command prompt or by having installed the compiler environment in to the default environment during MSVS installation.</p>
<p>On windows you can build from a cmd.exe or a cygwin window, with MSVS or GNU gcc. </p><div class="fragment"><div class="line"><span class="comment">/* Run the Visual Studio setup script (vcvars32.bat or vcvarsamd64.bat) from your compiler installation */</span></div><div class="line">C:/Python27/python ../xed/mfile.py examples    ( from a cmd.exe window <span class="keyword">using</span> win32 python)</div><div class="line"></div><div class="line"><span class="comment">/* or from cygwin, using MSVS, you must ensure your MSVS compiler environment is set up properly */</span></div><div class="line">../xed/mfile.py examples                        ( from a cygwin window, <span class="keyword">using</span> cygwin<span class="stringliteral">&#39;s python)</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral">/* if you installed the compiler in a standard place, you can have MBUILD set it up*/</span></div><div class="line"><span class="stringliteral">C:/Python27/python ../xed/mfile.py --setup-msvs --msvs-version 10 examples</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral">/* or from cygwin, using GCC */</span></div><div class="line"><span class="stringliteral">../xed/mfile.py --compiler=gnu examples         ( from a cygwin window, using cygwin&#39;</span>s gcc)</div></div><!-- fragment --><p>The cygwin builds will use cygwin's python to launch the mfile, but win32 c:/Python27/python to run the generators. I try to avoid building using cygwin's python because those builds are single threaded because of long standing bugs in cygwin.</p>
<p>If you want to have symbols in the xed command line example, you must build with MSVS 8 (2005) or later and supply the "--dbghelp" option to the build line. During execution, dbghelp.dll version 6.9.3.113 or later, is required. Dbghelp.dll must be placed in the same directory as xed.exe. Dbghelp.dll is available from Microsoft.</p>
<h1><a class="anchor" id="SHARED"></a>
Shared libraries and DLLs</h1>
<p>If you build XED using the --shared object you'll get a libxed.so on Linux or a libxed.dll on Windows. When you link against these shared objects/DLL you are required to define XED_DLL (/DXED_DLL on Windows or -DXED_DLL on Linux).</p>
<h1><a class="anchor" id="HELP"></a>
The mbuild options</h1>
<p>If you supply the --help message to the ../xed/mfile.py you'll see the various options controlling compilation. Some options are build into to mbuild and are not relevant for the XED0 build (like the assembler overrides). I've omitted the irrelevant ones in the following options listing:</p>
<div class="fragment"><div class="line">% ./mfile.py --help</div><div class="line">Usage: mfile.py [options]</div><div class="line"></div><div class="line">Options:</div><div class="line">  -h, --help            show <span class="keyword">this</span> help message and exit</div><div class="line">  -j JOBS, --jobs=JOBS  Number of concurrent worker threads to use.</div><div class="line">  --mbuild-version      Emit the version information</div><div class="line">  --build-dir=BUILD_DIR</div><div class="line">                        Build directory, <span class="keywordflow">default</span> is <span class="stringliteral">&#39;obj&#39;</span></div><div class="line">  --src-dir=SRC_DIR     The directory where the sources are located.</div><div class="line">  --gen-dir=GEN_DIR     The directory where generated sources are assumed to</div><div class="line">                        be located.</div><div class="line">  -v VERBOSE, --verbose=VERBOSE</div><div class="line">                        Verbosity level. Defaults to value passed to env_t()</div><div class="line">  --compiler=COMPILER   Compiler (ms,gnu,clang,icc,icl,iclang). Default is gnu</div><div class="line">                        on linux and ms on windows. Default is: gnu</div><div class="line">  --debug               Debug build</div><div class="line">  --shared              Shared DLL build</div><div class="line">  --<span class="keyword">static</span>              Statically link executables</div><div class="line">  --opt=OPT             Optimization level noopt, 0, 1, 2, 3</div><div class="line">  -s, --silent          Silence all but the most important messages</div><div class="line">  --extra-defines=EXTRA_DEFINES</div><div class="line">                        Extra preprocessor defines</div><div class="line">  --extra-flags=EXTRA_FLAGS</div><div class="line">                        Extra values <span class="keywordflow">for</span> CXXFLAGS and CCFLAGS</div><div class="line">  --extra-cxxflags=EXTRA_CXXFLAGS</div><div class="line">                        Extra values <span class="keywordflow">for</span> CXXFLAGS</div><div class="line">  --extra-ccflags=EXTRA_CCFLAGS</div><div class="line">                        Extra values <span class="keywordflow">for</span> CCFLAGS</div><div class="line">  --extra-linkflags=EXTRA_LINKFLAGS</div><div class="line">                        Extra values <span class="keywordflow">for</span> LINKFLAGS</div><div class="line">  --extra-libs=EXTRA_LIBS</div><div class="line">                        Extra values <span class="keywordflow">for</span> LIBS</div><div class="line">  --toolchain=TOOLCHAIN</div><div class="line">                        Compiler toolchain</div><div class="line">  --vc-dir=VC_DIR       MSVS Compiler VC directory. For finding libraries  and</div><div class="line">                        setting the toolchain</div><div class="line">  --msvs-version=MSVS_VERSION, --msvc-version=MSVS_VERSION, --msvsversion=MSVS_VERSION, --msvcversion=MSVS_VERSION</div><div class="line">                        MSVS version 6=VC98, 7=VS .Net 2003, 8=VS 2005, 9=VS</div><div class="line">                        2008, 10=VS 2010/DEV10, 11=VS2012/DEV11This sets</div><div class="line">                        certain flags and idioms <span class="keywordflow">for</span> quirks in some compilers.</div><div class="line">  --setup-msvc, --setup-msvs, --msvs-setup, --msvc-setup</div><div class="line">                        Use the value of the --msvc-version to initialize the</div><div class="line">                        MSVC configuration.</div><div class="line">  --icc-version=ICC_VERSION, --iccver=ICC_VERSION, --icc-ver=ICC_VERSION</div><div class="line">                        ICC/ICL version 7, 8, 9, 10, 11</div><div class="line">  --gcc-version=GCC_VERSION, --gccversion=GCC_VERSION, --gcc-ver=GCC_VERSION</div><div class="line">                        GCC version, with dots as in 2.96, 3.4.3, 4.2.0, etc.</div><div class="line">  --cc=CC               full path to C compiler</div><div class="line">  --cxx=CXX             full path to C++ compiler</div><div class="line">  --linker=LINKER       full path to linker</div><div class="line">  --ar=AR               full path to archiver (lib/ar)</div><div class="line">  --as=AS               full path to assembler (gas/as/ml/ml64)</div><div class="line">  --yasm                Use yasm</div><div class="line">  --no-cygwin-limit     Do not limit cygwin to one job at a time.  Default is</div><div class="line">                        to limit cygwin to one job.</div><div class="line">  --host-cpu=ARG_HOST_CPU</div><div class="line">                        Host CPU, typically ia32, intel64 or x86-64</div><div class="line">  --host-os=ARG_HOST_OS</div><div class="line">                        Host OS (where the binary runs)</div><div class="line">  --doxygen-install=DOXYGEN_INSTALL</div><div class="line">                        Doxygen installation directory</div><div class="line">  --doxygen=DOXYGEN     Doxygen command name</div><div class="line">  -c, --clean           Clean targets</div><div class="line">  -k, --keep-going      Keep going after errors occur when building</div><div class="line">  --messages            Enable use xed<span class="stringliteral">&#39;s debug messages</span></div><div class="line"><span class="stringliteral">  --asserts             Enable use xed&#39;</span>s asserts</div><div class="line">  --clr                 Compile <span class="keywordflow">for</span> Microsoft CLR</div><div class="line">  --no-werror           Disable use of -Werror on GNU compiles</div><div class="line">  --gen-ild-storage     Dump ILD storage data file.</div><div class="line">  --show-dag            Show the dependence DAG</div><div class="line">  --ext=EXT             Add extension files of the form</div><div class="line">                        pattern-name:file-name.txt</div><div class="line">  --extf=EXTF           Add extension configuration files     that contain</div><div class="line">                        lines of form pattern-name:file-name.txt. All files</div><div class="line">                        references will be made relative to the directory in</div><div class="line">                        which the     config file is located</div><div class="line">  --<span class="keywordflow">default</span>-isa-extf=DEFAULT_ISA</div><div class="line">                        Override the <span class="keywordflow">default</span> ISA files.cfg file</div><div class="line">  --knc                 Include KNC support</div><div class="line">  --no-avx              Do not include AVX</div><div class="line">  --no-xsaveopt         Do not include XSAVEOPT</div><div class="line">  --no-ivbavx           Do not include AVX <span class="keywordflow">for</span> IVB.</div><div class="line">  --no-ivbint           Do not include integer (nonAVX) IVB NI.</div><div class="line">  --no-avxhsw           Do not include AVX <span class="keywordflow">for</span> HSW.</div><div class="line">  --no-mpx              Do not include MPX.</div><div class="line">  --no-sha              Do not include SHA.</div><div class="line">  --no-bdw              Do not include BDW NI.</div><div class="line">  --no-glm              Do not include GLM.</div><div class="line">  --knl                 Include KNL AVX512{PF,ER} on top of AVX512{F,CD}.</div><div class="line">                        Default: Currently enabled.</div><div class="line">  --no-knl              Do no include KNL AVX512{PF,ER}. Default: KNL enabled.</div><div class="line">  --no-skl              Do not include SKL.</div><div class="line">  --no-skx              Do not include SKX.</div><div class="line">  --no-memory-future    Do not include future memory NI.</div><div class="line">  --no-avx512-future    Do not include future avx512 instructions.</div><div class="line">  --dbghelp             Use dbghelp.dll on windows.</div><div class="line">  --install-dir=INSTALL_DIR</div><div class="line">                        XED Install directory.</div><div class="line">                        Default: kits/xed-install-date-os-cpu</div><div class="line">  --kit-kind=KIT_KIND   Kit version <span class="keywordtype">string</span>.</div><div class="line">                        The <span class="keywordflow">default</span> is <span class="stringliteral">&#39;base&#39;</span></div><div class="line">  --no-amd              Disable AMD <span class="keyword">public</span> instructions</div><div class="line">  --limit-strings       Remove some strings to save space.</div><div class="line">  --no-encoder          Disable the encoder</div><div class="line">  --no-decoder          Disable the decoder</div><div class="line">  --generator-options=GENERATOR_OPTIONS</div><div class="line">                        Options to pass through <span class="keywordflow">for</span></div><div class="line">                        the decode generator</div><div class="line">  --legal-header=LEGAL_HEADER</div><div class="line">                        Use <span class="keyword">this</span> special legal header</div><div class="line">                        on <span class="keyword">public</span> header files and examples.</div><div class="line">  --python=PYTHONARG    Use a specific version of python</div><div class="line">                        <span class="keywordflow">for</span> subprocesses.</div><div class="line">  --elf-dwarf, --dwarf  Use libelf/libdwarf. (Linux only)</div><div class="line">  --dev                 Developer knob. Updates VERSION file</div><div class="line">  --elf-dwarf-precompiled</div><div class="line">                        Use precompiled libelf/libdwarf from  the XED source</div><div class="line">                        distribution. This is the currently required <span class="keywordflow">if</span> you</div><div class="line">                        are installing a kit. Implies the --elf-dwarf knob.</div><div class="line">                        (Linux only)</div><div class="line">  --strip=STRIP         Path to strip binary. (Linux only)</div><div class="line">  --pti-test            INTERNAL TESTING OPTION.</div><div class="line">  --compress-operands   use bit-fields to compress the operand storage.</div><div class="line">  --test-perf           Do performance test (on linux). Requires specific</div><div class="line">                        external test binary.</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
