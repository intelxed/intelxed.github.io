<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>X86 Encoder Decoder: Intel XED command interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">X86 Encoder Decoder
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__CMDLINE.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Intel XED command interface</div>  </div>
</div><!--header-->
<div class="contents">
<p>The command line tool called xed or xed.exe is built when you build the examples (<a class="el" href="group__EXAMPLES.html">Examples of using Intel XED</a>) that come with Intel XED. The xed-ex3 is just encode portion of the xed command line tool.</p>
<p>This tool is useful for encoding and decoding or even decoding-then-re-encoding a single instruction or all the instructions in the text segment of an ELF binary (32 or 64b). For decoding, just jump to the examples.</p>
<p>This section also explains a little language for writing the instructions for encode requests (-e option). I am constantly using this tool and updating it. The xed-ex3 (xed-ex3.exe) example is just the encoder portion of the xed command line tool.</p>
<p>The SUPPRESSED operands emitted by the decoder are not used when encoding. They are ignored. They are not required to select an encoding.</p>
<p>The syntax for encodable strings is as follows: </p><div class="fragment"><div class="line">Opcode[/width]   [operand [operand]]</div></div><!-- fragment --><p>The width is a 8, 16, 32 or 64, indicating the effective operand width if it differs from the default. 8b operations generally require this. Or since most operations that default to 32b widths in 64b mode, it is required for 64b operation widths in 64b mode.</p>
<p>The operand specifier is one of the following.</p>
<ul>
<li>A register name such as EAX or R8B, etc. Case does not matter.</li>
<li>An immediate specifier such as IMM:12ff</li>
<li>A branch displacement specifier such as BRDISP:0000001f</li>
<li>A memory specifier that indicates the base register, index register, scale value, and displacement value. If one of the fields is not required, a - is necessary. The displacement is omittable. For example: MEM4:ESI,EAX,8,ff or MEM4:EBX. The first one specifies that the memory address 4 bytes and should be ESI + EAX * 8 + 0xff. The second one specifies that EBX should be used to access 4 bytes of memory; note the displacement is omitted. A segment override can be specified as follows: MEM4:GS:EAX by using a segment-name followed by a ":" before the base register. If there is no base register, you can use a "-", for example: MEM4:GS:-,-,11223344. One also needs to specify a memory operation width. This can be accomplished by indicating a number of bytes just after the MEM specifier. For example: MEM2:EAX indicates a 2 byte memory operation.</li>
<li>An address generation specifer that has the same syntax as the above MEM: specifier, but is only used for LEA instructions. Example: AGEN:EAX,EBX,2,-</li>
</ul>
<p>Here is the help message:</p>
<div class="fragment"><div class="line">% obj/xed -h</div><div class="line">Usage: obj/xed [options]</div><div class="line">One of the following is required:</div><div class="line">  -i input_file             (decode file)</div><div class="line">  -ide input_file           (decode/encode file)</div><div class="line">  -d hex-string             (decode one instruction)</div><div class="line">  -e instruction            (encode, must be last)</div><div class="line">  -de hex-string            (decode-then-encode)</div><div class="line">  -F prefix                 (filter input with prefix)</div><div class="line"> </div><div class="line">Optional arguments:</div><div class="line">  -v verbosity  (0=quiet, 1=errors, 2=useful-info, 3=trace, 5=very verbose)</div><div class="line">  -n number-of-instructions-to-decode (<span class="keywordflow">default</span> 10,000, accepts K/M/G qualifiers)</div><div class="line">  -I            (Intel SYSV syntax <span class="keywordflow">for</span> disassembly)</div><div class="line">  -A            (ATT SYSV syntax <span class="keywordflow">for</span> disassembly)</div><div class="line">  -16           (<span class="keywordflow">for</span> LEGACY_16 mode)</div><div class="line">  -32           (<span class="keywordflow">for</span> LEGACY_32 mode, <span class="keywordflow">default</span>)</div><div class="line">  -64           (<span class="keywordflow">for</span> LONG_64 mode w/64b addressing)</div><div class="line">  -s32          (32b stack addressing, <span class="keywordflow">default</span>, not in LONG_64 mode)</div><div class="line">  -s16          (16b stack addressing, not in LONG_64 mode)</div></div><!-- fragment --><p>Here are a couple of examples:</p>
<div class="fragment"><div class="line">% xed -d 0000</div><div class="line">ADD INT_ALU BASE  Opcode: 00  MODRM: 00 Bytes: 2</div><div class="line">        Eb/EXPLICIT/RW Gb/EXPLICIT/R </div><div class="line">        ADD EffWidth: 8b</div><div class="line">        MachineMode: LEGACY_32 AddrWidth: 32b StackAddrWidth: 32b</div><div class="line">        MEM/EXPLICIT/RW REG/AL(REG8)/EXPLICIT/R </div><div class="line">        Read Write BASE= EAX(REG32) MemopLength = 1</div><div class="line"></div><div class="line">        rFLAGS: of-mod sf-mod zf-mod af-mod pf-mod cf-mod \ </div><div class="line">            Read:  Written: of sf zf af pf cf             writes</div><div class="line"></div><div class="line">% xed -e ADD EAX EBX</div><div class="line">Encodable! 01d8</div><div class="line"></div><div class="line">xed -e ADD EAX MEM4:ESP,EBX,4</div><div class="line">Encodable! 03049c</div><div class="line"></div><div class="line">% xed -d 6a00</div><div class="line">PUSH INT_ALU BASE  Opcode: 6a  Immed: 00 Bytes: 2</div><div class="line">        Ib/EXPLICIT/R STACKPUSH/SUPPRESSED/R </div><div class="line">        PUSH EffWidth: 32b</div><div class="line">        MachineMode: LEGACY_32 AddrWidth: 32b StackAddrWidth: 32b</div><div class="line">        MEM/SUPPRESSED/W REG/ESP(REG32)/SUPPRESSED/RW IMM/EXPLICIT/R </div><div class="line">        Write SEG= SS BASE= ESP(REG32) MemopLength = 4</div><div class="line">        IMMED: 00</div><div class="line"></div><div class="line">        Does not use rFLAGS</div><div class="line"></div><div class="line">% xed -e MOV EAX MEM4:SS:ESP</div><div class="line">Encodable! 8b0424</div><div class="line"></div><div class="line">% echo <span class="stringliteral">&#39;7f550c23efa1 __clone+0x31 insn: 48 85 c0&#39;</span> | xed -F insn: -A</div><div class="line">7f550c23efa1 __clone+0x31       test %rax, %rax</div></div><!-- fragment --><p>Or using the xed-ex3 example tool: </p><div class="fragment"><div class="line">% obj/xed-ex3</div><div class="line">Usage: obj/xed-ex3 [-16|-32|-64] [-s16|-s32] encode-<span class="keywordtype">string</span></div></div><!-- fragment --><p>The -16, -32 or -64 are for specifying the major mode of the machine. The major mode of the machine determines the default data operand size and default addressing width. In 64b mode, the default data size is 32b and the default addressing mode is 64b addressing. In 32b mode, the default addressing width is 32b. In 16b mode, the default addressing width is 16b. In 32b mode or 16b mode, the stack addressing width must also be specified. Usually it matches the major mode. The -s16 option is for specifying 16b stack addressing in 32b mode. The -s32 is for specifying 32b stack addressing in 16 bit mode.</p>
<div class="fragment"><div class="line">% obj/xed-ex3 -64 PUSH/64 RAX</div><div class="line">Encode request:</div><div class="line">PUSH Prefixes:  EffOpWidth: 64b EffAddrWidth: 64b</div><div class="line">        MachineMode: LONG_64 AddrWidth: 64b StackAddrWidth: 32b</div><div class="line">        REG/RAX(REG64)/EXPLICIT/RW </div><div class="line">        MemopLength = 0</div><div class="line"></div><div class="line">Encodable! 50</div><div class="line"></div><div class="line">% obj/xed-ex3 MOV MEM4:EAX IMM:11223344</div><div class="line">Encode request:</div><div class="line">MOV Prefixes:  EffOpWidth: 32b EffAddrWidth: 32b</div><div class="line">        MachineMode: LEGACY_32 AddrWidth: 32b StackAddrWidth: 32b</div><div class="line">        MEM0/EXPLICIT/RW IMM/EXPLICIT/RW </div><div class="line">        TmpltIdx=0 BASE= EAX(REG32) MemopLength = 0</div><div class="line">        IMMED: 0x11223344 signed: 1144201745 starts@byte: 1</div><div class="line"></div><div class="line">Encodable! c70011223344</div></div><!-- fragment --><h1><a class="anchor" id="ENCODE_EXAMPLE"></a>
An example of using the encoder</h1>
<p>The encoder language file which is part of the xed command line tool shows how to build up instructions from scratch. The example uses a string to drive the creation of the instruction, but that is just an example. Look at the parse_encode_request function for the required pieces.</p>
<div class="fragment"><div class="line"><span class="comment">/*BEGIN_LEGAL </span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (c) 2019 Intel Corporation</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><span class="comment">  you may not use this file except in compliance with the License.</span></div><div class="line"><span class="comment">  You may obtain a copy of the License at</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><span class="comment">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div><div class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><span class="comment">  See the License for the specific language governing permissions and</span></div><div class="line"><span class="comment">  limitations under the License.</span></div><div class="line"><span class="comment">  </span></div><div class="line"><span class="comment">END_LEGAL */</span></div><div class="line"></div><div class="line"><span class="comment">// This is an example of how to use the encoder from scratch in the context</span></div><div class="line"><span class="comment">// of parsing a string from the command line.  </span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span>  <span class="comment">// strtol, ...</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="xed-interface_8h.html">xed/xed-interface.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;xed-examples-util.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;xed-enc-lang.h&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> upcase(<span class="keywordtype">char</span>* s) {</div><div class="line">    (void)xed_upcase_buf(s);</div><div class="line">}</div><div class="line"></div><div class="line">xed_str_list_t* </div><div class="line">tokenize(<span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> s,</div><div class="line">         <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> delimiter)</div><div class="line">{</div><div class="line">    xed_str_list_t* slist = xed_tokenize(s, delimiter);</div><div class="line">    <span class="keywordflow">return</span> slist;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> slash_split(<span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> src,</div><div class="line">                 <span class="keywordtype">char</span>** first, <span class="comment">// output</span></div><div class="line">                 <span class="keywordtype">char</span>** second) <span class="comment">//output</span></div><div class="line">{</div><div class="line">    xed_str_list_t* sv = tokenize(src, <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line">    xed_str_list_t* p = sv;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> i=0;</div><div class="line">    <span class="keywordflow">for</span>(; p ; i++, p=p-&gt;next)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (i==0) {</div><div class="line">            *first = p-&gt;s;</div><div class="line">            *second = 0;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==1)</div><div class="line">            *second = p-&gt;s;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> valid;</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width_bits;</div><div class="line">    xed_uint64_t immed_val;</div><div class="line">} immed_parser_t;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> immed_parser_init(immed_parser_t* <span class="keyword">self</span>,</div><div class="line">                       <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> s, </div><div class="line">                       <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> tok0) </div><div class="line">{</div><div class="line">    xed_str_list_t* sv = tokenize(s,<span class="stringliteral">&quot;:&quot;</span>);</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> sz = xed_str_list_size(sv);</div><div class="line">    <span class="keyword">self</span>-&gt;valid = 0;</div><div class="line">    <span class="keywordflow">if</span> (sz==2) {</div><div class="line">        xed_str_list_t* p = sv;</div><div class="line">        <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> i = 0;</div><div class="line">        <span class="keywordflow">for</span>(; p ; i++, p=p-&gt;next)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (i == 0 &amp;&amp; strcmp(p-&gt;s,tok0) != 0)</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1) {</div><div class="line">                <span class="keyword">self</span>-&gt;immed_val = convert_ascii_hex_to_int(p-&gt;s);</div><div class="line">                <span class="comment">// nibbles to bits</span></div><div class="line">                <span class="keyword">self</span>-&gt;width_bits = <a class="code" href="xed-portability_8h.html#a3fb2e11b3d32594f913f5b80849133e1">XED_CAST</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>,strlen(p-&gt;s)*4);</div><div class="line">                <span class="keyword">self</span>-&gt;valid = 1;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> valid;</div><div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> segment_reg;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> segno;</div><div class="line">} seg_parser_t;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> seg_parser_init(seg_parser_t* <span class="keyword">self</span>,</div><div class="line">                            <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> s)</div><div class="line">{</div><div class="line">    xed_str_list_t* sv = tokenize(s,<span class="stringliteral">&quot;:&quot;</span>);</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> ntokens = xed_str_list_size(sv);</div><div class="line"></div><div class="line">    <span class="keyword">self</span>-&gt;valid=0;</div><div class="line">    <span class="keyword">self</span>-&gt;segment_reg= <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>;</div><div class="line">    <span class="keyword">self</span>-&gt;segno=0;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (ntokens == 2)</div><div class="line">    {</div><div class="line">        xed_str_list_t* p = sv;</div><div class="line">        <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> i = 0;</div><div class="line">        <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> segid = 99;</div><div class="line">        <span class="keywordflow">for</span>(; p ; i++, p=p-&gt;next)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (i == 0)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (strcmp(p-&gt;s,<span class="stringliteral">&quot;SEG&quot;</span>)==0 || strcmp(p-&gt;s,<span class="stringliteral">&quot;SEG0&quot;</span>)==0)</div><div class="line">                    segid = 0;</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(p-&gt;s,<span class="stringliteral">&quot;SEG1&quot;</span>)==0)</div><div class="line">                    segid = 1;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1 &amp;&amp; segid &lt; 2)</div><div class="line">            {</div><div class="line">                <span class="keyword">self</span>-&gt;segno = segid;</div><div class="line">                <span class="keyword">self</span>-&gt;segment_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(p-&gt;s);</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (self-&gt;segment_reg != <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a> &amp;&amp;</div><div class="line">                    <a class="code" href="group__REGINTFC.html#ga9003309edac48c9c1dfca2187497c613">xed_reg_class</a>(self-&gt;segment_reg) == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76ab02b323ba71ce251bca0ac4206b7d028">XED_REG_CLASS_SR</a>)</div><div class="line">                {</div><div class="line">                    <span class="keyword">self</span>-&gt;valid=1;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">        </div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">list2array(<span class="keywordtype">char</span>** array, xed_str_list_t* sl, <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> n)</div><div class="line">{</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> i=0;</div><div class="line">    xed_str_list_t* p = sl;</div><div class="line">    <span class="keywordflow">for</span>( ; p &amp;&amp; i &lt; n ; i++, p=p-&gt;next) </div><div class="line">        array[i] = p-&gt;s;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> match(<span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> s, <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> b)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (strcmp(s,b)==0)</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"><span class="keyword">static</span> <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> skip(<span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> s)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (match(s,<span class="stringliteral">&quot;-&quot;</span>) || match(s,<span class="stringliteral">&quot;NA&quot;</span>))</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line">            </div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line">{</div><div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> valid;</div><div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> mem;</div><div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> agen;</div><div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> disp_valid;</div><div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span>* segment;</div><div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span>* base;</div><div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span>* indx;</div><div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span>* scale;</div><div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span>* disp; <span class="comment">//displacement</span></div><div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> segment_reg;</div><div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> base_reg;</div><div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> index_reg;</div><div class="line">    xed_uint8_t scale_val;</div><div class="line"></div><div class="line">    xed_int64_t disp_val;</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> disp_width_bits;</div><div class="line"></div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> mem_len;</div><div class="line">} mem_bis_parser_t;  </div><div class="line">    <span class="comment">// parse: MEMlength:[segment:]base,index,scale[,displacement]</span></div><div class="line">    <span class="comment">// parse: AGEN:base,index,scale[,displacement]</span></div><div class="line">    <span class="comment">// The displacement is optional</span></div><div class="line"></div><div class="line">    <span class="comment">// split on colons first</span></div><div class="line">    <span class="comment">// MEM4:FS:EAX,EBX,4,223344   mem4 fs eax,ebx,4,22334455  -&gt; 3 tokens</span></div><div class="line">    <span class="comment">// MEM4:FS:EAX,EBX,4          mem4 fs eax,ebx,4   -&gt; 3 tokens</span></div><div class="line">    <span class="comment">// MEM4:EAX,EBX,4,223344      mem4 eax,ebx,4,223344..  -&gt; 2 tokens</span></div><div class="line">    <span class="comment">// MEM4:FS:EAX,EBX,4          mem4 fs  eas,ebx,4     -&gt; 3 tokens</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> mem_bis_parser_init(mem_bis_parser_t* <span class="keyword">self</span>, <span class="keywordtype">char</span>* s)</div><div class="line">{</div><div class="line">    xed_str_list_t* sv=0;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> ntokens=0;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> n_addr_tokens=0;</div><div class="line">    <span class="keywordtype">char</span>* addr_token=0;</div><div class="line">    <span class="keywordtype">char</span>* main_token=0;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> i=0;</div><div class="line">    xed_str_list_t* p = 0;</div><div class="line">    xed_str_list_t* sa = 0;</div><div class="line">    <span class="keywordtype">char</span>* astr[4];</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">self</span>-&gt;valid = 0;</div><div class="line">    <span class="keyword">self</span>-&gt;mem = 0;</div><div class="line">    <span class="keyword">self</span>-&gt;agen = 0;</div><div class="line">    <span class="keyword">self</span>-&gt;disp_valid = 0;</div><div class="line">    <span class="keyword">self</span>-&gt;segment = <span class="stringliteral">&quot;INVALID&quot;</span>;</div><div class="line">    <span class="keyword">self</span>-&gt;base = <span class="stringliteral">&quot;INVALID&quot;</span>;</div><div class="line">    <span class="keyword">self</span>-&gt;indx = <span class="stringliteral">&quot;INVALID&quot;</span>;</div><div class="line">    <span class="keyword">self</span>-&gt;scale = <span class="stringliteral">&quot;1&quot;</span>;</div><div class="line">    <span class="keyword">self</span>-&gt;segment_reg = <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>;</div><div class="line">    <span class="keyword">self</span>-&gt;base_reg = <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>;</div><div class="line">    <span class="keyword">self</span>-&gt;index_reg = <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>;</div><div class="line">    <span class="keyword">self</span>-&gt;disp_val = 0;</div><div class="line">    <span class="keyword">self</span>-&gt;disp_width_bits = 0;</div><div class="line">    <span class="keyword">self</span>-&gt;mem_len = 0;</div><div class="line"></div><div class="line">    upcase(s);</div><div class="line">    <span class="comment">// split on colon first</span></div><div class="line">    sv = tokenize(s,<span class="stringliteral">&quot;:&quot;</span>);</div><div class="line">    ntokens = xed_str_list_size(sv);</div><div class="line">        </div><div class="line">    i=0;</div><div class="line">    p = sv;</div><div class="line">    <span class="keywordflow">if</span> (ntokens !=2 &amp;&amp; ntokens != 3) <span class="comment">// 3 has segbase</span></div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    <span class="keywordflow">for</span>( ; p ; i++, p=p-&gt;next) {</div><div class="line">        <span class="keywordflow">if</span> (i==0)</div><div class="line">            main_token = p-&gt;s;</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==1 &amp;&amp; ntokens == 3)</div><div class="line">            <span class="keyword">self</span>-&gt;segment = p-&gt;s;</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==1 &amp;&amp; ntokens == 2)</div><div class="line">            addr_token = p-&gt;s;</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==2)</div><div class="line">            addr_token = p-&gt;s;</div><div class="line">    }</div><div class="line">    assert(main_token != 0);</div><div class="line">    <span class="keywordflow">if</span> (strcmp(main_token,<span class="stringliteral">&quot;AGEN&quot;</span>)==0)</div><div class="line">        <span class="keyword">self</span>-&gt;agen=1;</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(main_token,<span class="stringliteral">&quot;MEM&quot;</span>,3)==0) {</div><div class="line">        <span class="keyword">self</span>-&gt;mem = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    <span class="keywordflow">if</span> (self-&gt;mem &amp;&amp; strlen(main_token) &gt; 3) {</div><div class="line">        <span class="keywordtype">char</span>* mlen = main_token+3;</div><div class="line">        <span class="keyword">self</span>-&gt;mem_len = <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>,strtol(mlen,0,0));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (self-&gt;agen &amp;&amp; strcmp(self-&gt;segment,<span class="stringliteral">&quot;INVALID&quot;</span>)!=0)</div><div class="line">        xedex_derror(<span class="stringliteral">&quot;AGENs cannot have segment overrides&quot;</span>);</div><div class="line"></div><div class="line">    sa = tokenize(addr_token,<span class="stringliteral">&quot;,&quot;</span>);</div><div class="line">    n_addr_tokens = xed_str_list_size(sa);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (n_addr_tokens == 0 || n_addr_tokens &gt; 4)</div><div class="line">        xedex_derror(<span class="stringliteral">&quot;Bad addressing mode syntax for memop&quot;</span>);</div><div class="line"></div><div class="line">    list2array(astr, sa, n_addr_tokens);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!skip(astr[0]))</div><div class="line">        <span class="keyword">self</span>-&gt;base = astr[0];</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (n_addr_tokens &gt; 2)</div><div class="line">        <span class="keywordflow">if</span> (!skip(astr[1]))</div><div class="line">            <span class="keyword">self</span>-&gt;indx = astr[1];</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (n_addr_tokens &gt; 2) </div><div class="line">        <span class="keyword">self</span>-&gt;scale = astr[2];</div><div class="line">    <span class="keywordflow">if</span> (skip(self-&gt;scale))</div><div class="line">        <span class="keyword">self</span>-&gt;scale = <span class="stringliteral">&quot;1&quot;</span>;</div><div class="line">    <span class="keywordflow">if</span> (match(self-&gt;scale,<span class="stringliteral">&quot;1&quot;</span>) || match(self-&gt;scale,<span class="stringliteral">&quot;2&quot;</span>) ||</div><div class="line">        match(self-&gt;scale,<span class="stringliteral">&quot;4&quot;</span>) || match(self-&gt;scale,<span class="stringliteral">&quot;8&quot;</span>) ) {</div><div class="line">        <span class="keyword">self</span>-&gt;valid=1;</div><div class="line">        <span class="keyword">self</span>-&gt;scale_val = <a class="code" href="xed-portability_8h.html#a3fb2e11b3d32594f913f5b80849133e1">XED_CAST</a>(xed_uint8_t,strtol(self-&gt;scale, 0, 10));</div><div class="line">        <span class="keyword">self</span>-&gt;segment_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(self-&gt;segment);</div><div class="line">        <span class="keyword">self</span>-&gt;base_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(self-&gt;base);</div><div class="line">        <span class="keyword">self</span>-&gt;index_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(self-&gt;indx);</div><div class="line"></div><div class="line">        <span class="comment">// look for a displacement</span></div><div class="line">        <span class="keywordflow">if</span> (n_addr_tokens == 4 &amp;&amp; strcmp(astr[3], <span class="stringliteral">&quot;-&quot;</span>) != 0) {</div><div class="line">            xed_uint64_t unsigned64_disp=0;</div><div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nibbles = 0;</div><div class="line">            <span class="keyword">self</span>-&gt;disp = astr[3];</div><div class="line">            <span class="keyword">self</span>-&gt;disp_valid = 1;</div><div class="line">            nibbles = <a class="code" href="xed-portability_8h.html#a7bb6c2f4c722b4f7357ecf13eb7e4b07">xed_strlen</a>(self-&gt;disp);</div><div class="line">            <span class="keywordflow">if</span> (nibbles &amp; 1) </div><div class="line">                xedex_derror(<span class="stringliteral">&quot;Displacement must have an even number of nibbles&quot;</span>);</div><div class="line">            unsigned64_disp = convert_ascii_hex_to_int(self-&gt;disp);</div><div class="line">            <span class="keyword">self</span>-&gt;disp_width_bits = nibbles*4; <span class="comment">// nibbles to bits</span></div><div class="line">            <span class="keywordflow">switch</span> (self-&gt;disp_width_bits){</div><div class="line">              <span class="keywordflow">case</span> 8:  <span class="keyword">self</span>-&gt;disp_val = <a class="code" href="xed-util_8h.html#a29a8c7d15c7bed2f34e174764b7532c6">xed_sign_extend8_64</a>((xed_int8_t)unsigned64_disp);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">              <span class="keywordflow">case</span> 16: <span class="keyword">self</span>-&gt;disp_val = <a class="code" href="xed-util_8h.html#a11ce8adb47394961e0963153f905a8c0">xed_sign_extend16_64</a>((xed_int16_t)unsigned64_disp);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">              <span class="keywordflow">case</span> 32: <span class="keyword">self</span>-&gt;disp_val = <a class="code" href="xed-util_8h.html#a18389860c680a9845b9b5045f3306089">xed_sign_extend32_64</a>((xed_int32_t)unsigned64_disp);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">              <span class="keywordflow">case</span> 64: <span class="keyword">self</span>-&gt;disp_val = (xed_int64_t)unsigned64_disp;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }               </div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> find_vl(<a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> reg, <a class="code" href="xed-types_8h.html#a349b1a771c4078c6828d9000243752a1">xed_int_t</a>* vl)</div><div class="line">{</div><div class="line">    <span class="comment">// This will &quot;grow&quot; bad user settings. So if you try to specify /128 on</span></div><div class="line">    <span class="comment">// the instruction and it sees a YMM or ZMM register operand, then</span></div><div class="line">    <span class="comment">// it&#39;ll grow the VL to the right observed size. The right observed</span></div><div class="line">    <span class="comment">// size might still be wrong, that is too small (as it can be for</span></div><div class="line">    <span class="comment">// &quot;shrinking&quot; converts (PD2PS, PD2DQ, etc.).</span></div><div class="line">    <a class="code" href="xed-types_8h.html#a349b1a771c4078c6828d9000243752a1">xed_int_t</a> nvl = *vl;</div><div class="line">    <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76">xed_reg_class_enum_t</a> rc = <a class="code" href="group__REGINTFC.html#ga9003309edac48c9c1dfca2187497c613">xed_reg_class</a>(reg);</div><div class="line">    <span class="keywordflow">if</span> (rc == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76a348c67420521d6089161d147b36565c2">XED_REG_CLASS_XMM</a> &amp;&amp; nvl == -1)  <span class="comment">// not set and see xmm</span></div><div class="line">        *vl = 0;</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76a48f1d7eaa9f38ea082107f49f301a821">XED_REG_CLASS_YMM</a> &amp;&amp; nvl &lt; 1) <span class="comment">// not set, set to xmm and then see ymm</span></div><div class="line">        *vl = 1;</div><div class="line"><span class="preprocessor">#if defined(XED_SUPPORTS_AVX512)</span></div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76a27c9341e557282c73d2e94f4b65c8222">XED_REG_CLASS_ZMM</a> &amp;&amp; nvl &lt; 2) <span class="comment">// not set, set to xmm or ymm and then see zmm</span></div><div class="line">        *vl = 2;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="structxed__decoded__inst__s.html">xed_encoder_request_t</a></div><div class="line">parse_encode_request(ascii_encode_request_t areq)</div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div><div class="line">    <a class="code" href="structxed__decoded__inst__s.html">xed_encoder_request_t</a> req;</div><div class="line">    <span class="keywordtype">char</span>* cfirst=0;</div><div class="line">    <span class="keywordtype">char</span>* csecond=0;</div><div class="line">    xed_str_list_t* tokens = 0;</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> token_index = 0;</div><div class="line">    xed_str_list_t* p = 0;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> memop = 0;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> regnum = 0;</div><div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> operand_index = 0;</div><div class="line">    <a class="code" href="xed-iclass-enum_8h.html#ad318511ae9cc50f102251b3c91a1ab9f">xed_iclass_enum_t</a> iclass = <a class="code" href="xed-iclass-enum_8h.html#ad318511ae9cc50f102251b3c91a1ab9fa2c77d475f97998fe763062db09fd15de">XED_ICLASS_INVALID</a>;</div><div class="line">    <a class="code" href="xed-types_8h.html#a349b1a771c4078c6828d9000243752a1">xed_int_t</a> vl = -1;</div><div class="line">    <a class="code" href="xed-types_8h.html#a349b1a771c4078c6828d9000243752a1">xed_int_t</a> uvl = -1;</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">// this calls xed_encoder_request_zero()</span></div><div class="line">    <a class="code" href="group__ENC.html#ga8a379853ad688ff61de9e73862617e40">xed_encoder_request_zero_set_mode</a>(&amp;req,&amp;(areq.dstate));</div><div class="line"></div><div class="line">    <span class="comment">/* This is the important function here. This encodes an instruction</span></div><div class="line"><span class="comment">       from scratch.</span></div><div class="line"><span class="comment">       </span></div><div class="line"><span class="comment">    You must set:</span></div><div class="line"><span class="comment">    the machine mode (machine width, addressing widths)</span></div><div class="line"><span class="comment">    the iclass</span></div><div class="line"><span class="comment">    for some instructions you need to specify prefixes (like REP or LOCK).</span></div><div class="line"><span class="comment">    the operands:</span></div><div class="line"><span class="comment">    </span></div><div class="line"><span class="comment">           operand kind (XED_OPERAND_{AGEN,MEM0,MEM1,IMM0,IMM1,</span></div><div class="line"><span class="comment">           RELBR,PTR,REG0...REG15}</span></div><div class="line"><span class="comment">           </span></div><div class="line"><span class="comment">           operand order</span></div><div class="line"><span class="comment">           </span></div><div class="line"><span class="comment">              xed_encoder_request_set_operand_order(&amp;req,operand_index,</span></div><div class="line"><span class="comment">                                                       XED_OPERAND_*);</span></div><div class="line"><span class="comment">              where the operand_index is a sequential index starting at zero.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">           operand details </span></div><div class="line"><span class="comment">                     FOR MEMOPS: base,segment,index,scale,</span></div><div class="line"><span class="comment">                                         displacement for memops, </span></div><div class="line"><span class="comment">                  FOR REGISTERS: register name</span></div><div class="line"><span class="comment">                 FOR IMMEDIATES: immediate values</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    tokens = tokenize(areq.command,<span class="stringliteral">&quot; &quot;</span>);</div><div class="line">    p = tokens;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> ( ; p ; token_index++, p=p-&gt;next ) {</div><div class="line">        slash_split(p-&gt;s, &amp;cfirst, &amp;csecond);</div><div class="line">        assert(cfirst);</div><div class="line">        upcase(cfirst);</div><div class="line">        <span class="keywordflow">if</span> (CLIENT_VERBOSE3)</div><div class="line">            printf( <span class="stringliteral">&quot;[%s][%s][%s]\n&quot;</span>, p-&gt;s,</div><div class="line">                    (cfirst?cfirst:<span class="stringliteral">&quot;NULL&quot;</span>),</div><div class="line">                    (csecond?csecond:<span class="stringliteral">&quot;NULL&quot;</span>));</div><div class="line"></div><div class="line">        <span class="comment">// consumed token, advance &amp; exit</span></div><div class="line">        p = p-&gt;next;</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// we can attempt to override the mode</span></div><div class="line">    <span class="keywordflow">if</span> (csecond)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (strcmp(csecond,<span class="stringliteral">&quot;8&quot;</span>)==0) </div><div class="line">            <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 8);</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(csecond,<span class="stringliteral">&quot;16&quot;</span>)==0) </div><div class="line">            <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 16);</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(csecond, <span class="stringliteral">&quot;32&quot;</span>)==0) </div><div class="line">            <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 32);</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(csecond,<span class="stringliteral">&quot;64&quot;</span>)==0)</div><div class="line">            <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 64);</div><div class="line">        </div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(csecond,<span class="stringliteral">&quot;128&quot;</span>)==0)</div><div class="line">            uvl = 0;</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(csecond,<span class="stringliteral">&quot;256&quot;</span>)==0)</div><div class="line">            uvl = 1;</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(csecond,<span class="stringliteral">&quot;512&quot;</span>)==0)</div><div class="line">            uvl = 2;</div><div class="line">    }</div><div class="line"></div><div class="line">    assert(cfirst != 0);</div><div class="line">    iclass =  <a class="code" href="group__ENUM.html#gac4b76adf6ede75bbc5754866187fcfa2">str2xed_iclass_enum_t</a>(cfirst);</div><div class="line">    <span class="keywordflow">if</span> (iclass == <a class="code" href="xed-iclass-enum_8h.html#ad318511ae9cc50f102251b3c91a1ab9fa2c77d475f97998fe763062db09fd15de">XED_ICLASS_INVALID</a>) {</div><div class="line">        fprintf(stderr,<span class="stringliteral">&quot;[XED CLIENT ERROR] Bad instruction name: %s\n&quot;</span>,</div><div class="line">                cfirst);</div><div class="line">        exit(1);</div><div class="line">    }</div><div class="line">    <a class="code" href="group__ENC.html#gaff030e16b97deae21b1f7613684c54c7">xed_encoder_request_set_iclass</a>(&amp;req, iclass );</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// put the operands in the request. Loop through tokens </span></div><div class="line">    <span class="comment">// (skip the opcode iclass, handled above)</span></div><div class="line">    <span class="keywordflow">for</span>( i=token_index; p ; i++, operand_index++, p=p-&gt;next ) {</div><div class="line">        mem_bis_parser_t mem_bis;</div><div class="line">        seg_parser_t seg_parser;</div><div class="line">        immed_parser_t imm;</div><div class="line">        immed_parser_t simm;</div><div class="line">        immed_parser_t imm2;</div><div class="line">        immed_parser_t disp;</div><div class="line">        immed_parser_t ptr_disp;</div><div class="line">        <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> reg = <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>;</div><div class="line">        <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011a">xed_operand_enum_t</a> r;</div><div class="line">                    </div><div class="line">        <span class="keywordtype">char</span>* cres_reg=0;</div><div class="line">        <span class="keywordtype">char</span>* csecond_x=0; <span class="comment">//FIXME: not used</span></div><div class="line">        slash_split(p-&gt;s, &amp;cres_reg, &amp;csecond_x);</div><div class="line">        upcase(cres_reg);</div><div class="line">        <span class="comment">// prune the AGEN or MEM(base,index,scale[,displacement]) text from</span></div><div class="line">        <span class="comment">// cres_reg</span></div><div class="line">        </div><div class="line">        <span class="comment">// FIXME: add MEM(immed) for the OC1_A and OC1_O types????</span></div><div class="line">        mem_bis_parser_init(&amp;mem_bis,cres_reg);</div><div class="line">        <span class="keywordflow">if</span> (mem_bis.valid) {</div><div class="line">            <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76">xed_reg_class_enum_t</a> rc = <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76ae913260759e30f32c4553ad763c3db76">XED_REG_CLASS_INVALID</a>;</div><div class="line">            <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76">xed_reg_class_enum_t</a> rci = <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76ae913260759e30f32c4553ad763c3db76">XED_REG_CLASS_INVALID</a>;</div><div class="line">            </div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (mem_bis.mem) {</div><div class="line">                <span class="keywordflow">if</span> (memop == 0) {</div><div class="line">                    <span class="comment">// Tell XED that we have a memory operand</span></div><div class="line">                    <a class="code" href="group__ENC.html#ga7b4e446882bcc615e917132f3fbb16b3">xed_encoder_request_set_mem0</a>(&amp;req);</div><div class="line">                    <span class="comment">// Tell XED that the mem0 operand is the next operand:</span></div><div class="line">                    <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(</div><div class="line">                        &amp;req,operand_index, <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa17757f8f75fb149d6a9ceff628403994">XED_OPERAND_MEM0</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> {</div><div class="line">                    <a class="code" href="group__ENC.html#gafe70e5db7dc59e9880f2db3ec7e71d9d">xed_encoder_request_set_mem1</a>(&amp;req);</div><div class="line">                    <span class="comment">// Tell XED that the mem1 operand is the next operand:</span></div><div class="line">                    <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(</div><div class="line">                        &amp;req,operand_index, <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aabe26987877ba7bfe6b67c7106fd77286">XED_OPERAND_MEM1</a>);</div><div class="line">                }</div><div class="line">                memop++;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mem_bis.agen) {</div><div class="line">                <span class="comment">// Tell XED we have an AGEN</span></div><div class="line">                <a class="code" href="group__ENC.html#gaac846d407fd6537461a6efaccff7609d">xed_encoder_request_set_agen</a>(&amp;req);</div><div class="line">                <span class="comment">// The AGEN is the next operand</span></div><div class="line">                <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(</div><div class="line">                    &amp;req,operand_index, <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa3ce839ecfbe4f991f6c46b7cb767a703">XED_OPERAND_AGEN</a>);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> </div><div class="line">                assert(mem_bis.agen || mem_bis.mem);</div><div class="line"></div><div class="line">            </div><div class="line">            rc = <a class="code" href="group__REGINTFC.html#ga46208c55a69fb76e42f1b5755aa4923e">xed_gpr_reg_class</a>(mem_bis.base_reg);</div><div class="line">            rci = <a class="code" href="group__REGINTFC.html#ga46208c55a69fb76e42f1b5755aa4923e">xed_gpr_reg_class</a>(mem_bis.index_reg);</div><div class="line">            <span class="keywordflow">if</span> (mem_bis.base_reg == <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61a964b335e035bb710e28c91215102bce2">XED_REG_EIP</a>)</div><div class="line">                <a class="code" href="group__ENC.html#gab416edcadb0d2b59fb62cfcd93991c3d">xed_encoder_request_set_effective_address_size</a>(&amp;req, 32);</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76aaca8356f5ea67683de3d49fb3de4583f">XED_REG_CLASS_GPR32</a> || rci == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76aaca8356f5ea67683de3d49fb3de4583f">XED_REG_CLASS_GPR32</a>)</div><div class="line">                <a class="code" href="group__ENC.html#gab416edcadb0d2b59fb62cfcd93991c3d">xed_encoder_request_set_effective_address_size</a>(&amp;req, 32);</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76a1a30b5648fb9dd4f8d9052cbe113f791">XED_REG_CLASS_GPR16</a> || rci == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76a1a30b5648fb9dd4f8d9052cbe113f791">XED_REG_CLASS_GPR16</a>) </div><div class="line">                <a class="code" href="group__ENC.html#gab416edcadb0d2b59fb62cfcd93991c3d">xed_encoder_request_set_effective_address_size</a>(&amp;req, 16);</div><div class="line"></div><div class="line">            <span class="comment">// fill in the memory fields</span></div><div class="line">            <a class="code" href="group__ENC.html#ga9002c58e013af93550df7bd9b37e13ed">xed_encoder_request_set_base0</a>(&amp;req, mem_bis.base_reg);</div><div class="line">            <a class="code" href="group__ENC.html#gad436ed3d253f15e11f4c943e0308db06">xed_encoder_request_set_index</a>(&amp;req, mem_bis.index_reg);</div><div class="line">            <a class="code" href="group__ENC.html#gaca791f284c852c6ae4c071ba5751d257">xed_encoder_request_set_scale</a>(&amp;req, mem_bis.scale_val);</div><div class="line">            <a class="code" href="group__ENC.html#ga72a43d42aa1c15bba69bcab84439471a">xed_encoder_request_set_seg0</a>(&amp;req, mem_bis.segment_reg);</div><div class="line">            find_vl(mem_bis.index_reg, &amp;vl); <span class="comment">// for scatter/gather</span></div><div class="line">            <span class="keywordflow">if</span> (mem_bis.mem_len) </div><div class="line">                <a class="code" href="group__ENC.html#ga03790a14a625c544edcbda559e359f14">xed_encoder_request_set_memory_operand_length</a>(</div><div class="line">                    &amp;req,</div><div class="line">                    mem_bis.mem_len ); <span class="comment">// BYTES</span></div><div class="line">            <span class="keywordflow">if</span> (mem_bis.disp_valid)</div><div class="line">                <a class="code" href="group__ENC.html#gaf745dfb40af1361b8a9b9f1ecb4f0228">xed_encoder_request_set_memory_displacement</a>(</div><div class="line">                    &amp;req,</div><div class="line">                    mem_bis.disp_val,</div><div class="line">                    mem_bis.disp_width_bits/8);</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        seg_parser_init(&amp;seg_parser,cres_reg);</div><div class="line">        <span class="keywordflow">if</span> (seg_parser.valid) {</div><div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div><div class="line">                printf(<span class="stringliteral">&quot;Setting segment to %s\n&quot;</span>,</div><div class="line">                       <a class="code" href="group__ENUM.html#ga2219331ccd4d809d431e81fe5e857e95">xed_reg_enum_t2str</a>(seg_parser.segment_reg));</div><div class="line">            <span class="keywordflow">if</span> (seg_parser.segno == 0)</div><div class="line">                <a class="code" href="group__ENC.html#ga72a43d42aa1c15bba69bcab84439471a">xed_encoder_request_set_seg0</a>(&amp;req, seg_parser.segment_reg);</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">                <span class="comment">/*  need SEG1 for MOVS[BWDQ]*/</span></div><div class="line">                <a class="code" href="group__ENC.html#gafb3db0b671837fab077f4db357c7fe04">xed_encoder_request_set_seg1</a>(&amp;req, seg_parser.segment_reg);</div><div class="line"></div><div class="line">            <span class="comment">/* SEG/SEG0/SEG1 is NOT a normal operand. It is a setting, like</span></div><div class="line"><span class="comment">             * the lock prefix. Normally the segment will be specified with</span></div><div class="line"><span class="comment">             * normal memory operations. With memops without MODRM, or</span></div><div class="line"><span class="comment">             * impliclit memops, we need a way of specifying the segment</span></div><div class="line"><span class="comment">             * when it is not the default. This is the way. it does not</span></div><div class="line"><span class="comment">             * change encoding forms. (When segments are &quot;moved&quot;, they are</span></div><div class="line"><span class="comment">             * REG operands, not SEG0/1, and are specified by name like EAX</span></div><div class="line"><span class="comment">             * is.) */</span></div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        immed_parser_init(&amp;imm,cres_reg, <span class="stringliteral">&quot;IMM&quot;</span>);</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span> (imm.valid) {</div><div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div><div class="line">                printf(<span class="stringliteral">&quot;Setting immediate value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line">                       imm.immed_val);</div><div class="line">            <a class="code" href="group__ENC.html#ga5dcaec413dfefdd6ca2ad179e5a181c9">xed_encoder_request_set_uimm0_bits</a>(&amp;req, </div><div class="line">                                               imm.immed_val,</div><div class="line">                                               imm.width_bits);</div><div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div><div class="line">                                                  operand_index,</div><div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa7cfee5454147cd3ea586172facd26f30">XED_OPERAND_IMM0</a>);</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line">        immed_parser_init(&amp;simm,cres_reg, <span class="stringliteral">&quot;SIMM&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (simm.valid) {</div><div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div><div class="line">                printf(<span class="stringliteral">&quot;Setting immediate value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line">                       simm.immed_val);</div><div class="line">            <a class="code" href="group__ENC.html#gaf2477dc50a13ec112d7cf3f3fa5c9178">xed_encoder_request_set_simm</a>(</div><div class="line">                &amp;req, </div><div class="line">                <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(xed_int32_t,simm.immed_val),</div><div class="line">                simm.width_bits/8); <span class="comment">//FIXME</span></div><div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div><div class="line">                                                  operand_index,</div><div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa7cfee5454147cd3ea586172facd26f30">XED_OPERAND_IMM0</a>);</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        immed_parser_init(&amp;imm2,cres_reg, <span class="stringliteral">&quot;IMM2&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (imm2.valid) {</div><div class="line">            <span class="keywordflow">if</span> (imm2.width_bits != 8)</div><div class="line">                xedex_derror(<span class="stringliteral">&quot;2nd immediate must be just 1 byte long&quot;</span>);</div><div class="line">            <a class="code" href="group__ENC.html#ga4edd1347ebaceee3811584123b4daa9b">xed_encoder_request_set_uimm1</a>(&amp;req, (xed_uint8_t)imm2.immed_val);</div><div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div><div class="line">                                                  operand_index,</div><div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aaecf4b40f8ec183182501a80b93b5b4dc">XED_OPERAND_IMM1</a>);</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        immed_parser_init(&amp;disp,cres_reg, <span class="stringliteral">&quot;BRDISP&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (disp.valid) {</div><div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div><div class="line">                printf(<span class="stringliteral">&quot;Setting  displacement value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line">                       disp.immed_val);</div><div class="line">            <a class="code" href="group__ENC.html#ga3594acbdb2001a816da28b7554b2ae4c">xed_encoder_request_set_branch_displacement</a>(</div><div class="line">                &amp;req,</div><div class="line">                <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(xed_int32_t,disp.immed_val),</div><div class="line">                disp.width_bits/8); <span class="comment">//FIXME</span></div><div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div><div class="line">                                                  operand_index,</div><div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa6f36302cd147e020b2662b75fa314c17">XED_OPERAND_RELBR</a>);</div><div class="line">            <a class="code" href="group__ENC.html#gad447fb779e58b7eaae0dd54e51af6066">xed_encoder_request_set_relbr</a>(&amp;req);</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        immed_parser_init(&amp;ptr_disp,cres_reg, <span class="stringliteral">&quot;PTR&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (ptr_disp.valid) {</div><div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div><div class="line">                printf(<span class="stringliteral">&quot;Setting pointer displacement value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line">                       ptr_disp.immed_val);</div><div class="line">            <a class="code" href="group__ENC.html#ga3594acbdb2001a816da28b7554b2ae4c">xed_encoder_request_set_branch_displacement</a>(</div><div class="line">                &amp;req,</div><div class="line">                <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(xed_int32_t,ptr_disp.immed_val),</div><div class="line">                ptr_disp.width_bits/8); <span class="comment">//FIXME</span></div><div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div><div class="line">                                                  operand_index,</div><div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aaf84141b5908fd0d494f446a66f3eeef3">XED_OPERAND_PTR</a>);</div><div class="line">            <a class="code" href="group__ENC.html#ga7be1c7da28a5d88f485f7e80b67959b4">xed_encoder_request_set_ptr</a>(&amp;req);</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(cres_reg);</div><div class="line">        <span class="keywordflow">if</span> (reg == <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>) {</div><div class="line">            fprintf(stderr,</div><div class="line">                    <span class="stringliteral">&quot;[XED CLIENT ERROR] Bad register name: %s on operand %u\n&quot;</span>,</div><div class="line">                    cres_reg, i);</div><div class="line">            exit(1);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (areq.dstate.mmode != <a class="code" href="xed-machine-mode-enum_8h.html#a754db9d73c5365644094cd161fe570a7a708dc25876ca1910c387c0a4f2f066cb">XED_MACHINE_MODE_LONG_64</a>)</div><div class="line">            <span class="keywordflow">if</span> (reg == <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61a230de5f9718ee37117d83f61bcbe5f46">XED_REG_DIL</a> || reg == <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61ad6c133bbbecb808e5319355f6c422c25">XED_REG_SPL</a> ||  reg == <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61a5ba64887142416e7a0eb012220d6027c">XED_REG_BPL</a> ||  reg == <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61a96dbea34f2eefe6c944f5fac9ef55dc6">XED_REG_SIL</a>)</div><div class="line">            {</div><div class="line">                fprintf(stderr,</div><div class="line">                        <span class="stringliteral">&quot;[XED CLIENT ERROR] Cannot use DIL/SPL/BPL/SIL outside of 64b mode\n&quot;</span>);</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">        <span class="comment">// The registers operands are numbered starting from the first one</span></div><div class="line">        <span class="comment">// as XED_OPERAND_REG0. We increment regnum (below) every time we</span></div><div class="line">        <span class="comment">// add a register operands.</span></div><div class="line">        r = <a class="code" href="xed-portability_8h.html#a3fb2e11b3d32594f913f5b80849133e1">XED_CAST</a>(<a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011a">xed_operand_enum_t</a>,<a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa4a8a5c45ea6041f25d7b98e3892bb389">XED_OPERAND_REG0</a> + regnum);</div><div class="line">        <span class="comment">// store the register identifier in the operand storage field</span></div><div class="line">        <a class="code" href="group__ENC.html#gaba22ae36cab0f632d5461830cc9a3133">xed_encoder_request_set_reg</a>(&amp;req, r, reg);</div><div class="line">        <span class="comment">// store the operand storage field name in the encode-order array</span></div><div class="line">        <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req, operand_index, r);</div><div class="line"></div><div class="line">        find_vl(reg, &amp;vl);</div><div class="line">        </div><div class="line">        regnum++;</div><div class="line">    } <span class="comment">// for loop</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (uvl == -1)</div><div class="line">    {</div><div class="line">        <span class="comment">// no user VL setting, so use our observation-based guess.</span></div><div class="line">        <span class="keywordflow">if</span> (vl&gt;=0) </div><div class="line">            <a class="code" href="xed-operand-accessors_8h.html#adcaebd214aa9b9d18d2929b3cd44f340">xed3_operand_set_vl</a>(&amp;req,(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>)vl);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (vl &gt;= 0 &amp;&amp; uvl &lt; vl)</div><div class="line">            xedex_derror(<span class="stringliteral">&quot;User specified VL is smaller than largest observed register.&quot;</span>);</div><div class="line">        <span class="comment">// go with the user value. The encoder still might increase it</span></div><div class="line">        <span class="comment">// based on observed values. But we test for that above so they&#39;ll</span></div><div class="line">        <span class="comment">// get the feedback.</span></div><div class="line">        <a class="code" href="xed-operand-accessors_8h.html#adcaebd214aa9b9d18d2929b3cd44f340">xed3_operand_set_vl</a>(&amp;req,(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>)uvl);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> req;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
