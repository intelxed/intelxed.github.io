<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>X86 Encoder Decoder: Patching instructions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">X86 Encoder Decoder
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__ENCHLPATCH.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Patching instructions</div>  </div>
</div><!--header-->
<div class="contents">

<p>These functions are useful for JITs and other uses where one must modify certain fields of instructions after encoding. To modify an instruction, one must encode it (creating an itext array of bytes) and then decode it (so that the patching routines know where the various fields are located.). Once the itext and the decoded instruction are available, certain fields can be modified.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Patching decoded instructions</h2></td></tr>
<tr class="memitem:gaf32817a117fdcb36ab6ba2962a89c069"><td class="memItemLeft" align="right" valign="top"><a class="el" href="xed-common-hdrs_8h.html#a029d5ee2957ac2af5e2b75ec09f1daf9">XED_DLL_EXPORT</a> <a class="el" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ENCHLPATCH.html#gaf32817a117fdcb36ab6ba2962a89c069">xed_patch_disp</a> (<a class="el" href="group__DEC.html#gacc9a7be76b242c5bf65f56036f5399e6">xed_decoded_inst_t</a> *xedd, xed_uint8_t *itext, <a class="el" href="structxed__enc__displacement__t.html">xed_enc_displacement_t</a> disp)</td></tr>
<tr class="memdesc:gaf32817a117fdcb36ab6ba2962a89c069"><td class="mdescLeft">&#160;</td><td class="mdescRight">Replace a memory displacement.  <a href="group__ENCHLPATCH.html#gaf32817a117fdcb36ab6ba2962a89c069">More...</a><br /></td></tr>
<tr class="separator:gaf32817a117fdcb36ab6ba2962a89c069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5af27d14d3e818689fc0a050e40119d9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="xed-common-hdrs_8h.html#a029d5ee2957ac2af5e2b75ec09f1daf9">XED_DLL_EXPORT</a> <a class="el" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ENCHLPATCH.html#ga5af27d14d3e818689fc0a050e40119d9">xed_patch_brdisp</a> (<a class="el" href="group__DEC.html#gacc9a7be76b242c5bf65f56036f5399e6">xed_decoded_inst_t</a> *xedd, xed_uint8_t *itext, <a class="el" href="structxed__encoder__operand__t.html">xed_encoder_operand_t</a> disp)</td></tr>
<tr class="memdesc:ga5af27d14d3e818689fc0a050e40119d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Replace a relative/absolute branch displacement.  <a href="group__ENCHLPATCH.html#ga5af27d14d3e818689fc0a050e40119d9">More...</a><br /></td></tr>
<tr class="separator:ga5af27d14d3e818689fc0a050e40119d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga12f47e7d7f9998e9d8fd0d750aba54f4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="xed-common-hdrs_8h.html#a029d5ee2957ac2af5e2b75ec09f1daf9">XED_DLL_EXPORT</a> <a class="el" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ENCHLPATCH.html#ga12f47e7d7f9998e9d8fd0d750aba54f4">xed_patch_imm0</a> (<a class="el" href="group__DEC.html#gacc9a7be76b242c5bf65f56036f5399e6">xed_decoded_inst_t</a> *xedd, xed_uint8_t *itext, <a class="el" href="structxed__encoder__operand__t.html">xed_encoder_operand_t</a> imm0)</td></tr>
<tr class="memdesc:ga12f47e7d7f9998e9d8fd0d750aba54f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Replace an imm0 immediate value.  <a href="group__ENCHLPATCH.html#ga12f47e7d7f9998e9d8fd0d750aba54f4">More...</a><br /></td></tr>
<tr class="separator:ga12f47e7d7f9998e9d8fd0d750aba54f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>These functions are useful for JITs and other uses where one must modify certain fields of instructions after encoding. To modify an instruction, one must encode it (creating an itext array of bytes) and then decode it (so that the patching routines know where the various fields are located.). Once the itext and the decoded instruction are available, certain fields can be modified. </p>
<p>The decode step required to create patchable instructions obviously takes additional time so it is suggested one only create patchable instructions once as templates and re-use them as needed.</p>
<p>See examples/xed-ex9-patch.c for an example. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga5af27d14d3e818689fc0a050e40119d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5af27d14d3e818689fc0a050e40119d9">&#9670;&nbsp;</a></span>xed_patch_brdisp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="xed-common-hdrs_8h.html#a029d5ee2957ac2af5e2b75ec09f1daf9">XED_DLL_EXPORT</a> <a class="el" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> xed_patch_brdisp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__DEC.html#gacc9a7be76b242c5bf65f56036f5399e6">xed_decoded_inst_t</a> *&#160;</td>
          <td class="paramname"><em>xedd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">xed_uint8_t *&#160;</td>
          <td class="paramname"><em>itext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structxed__encoder__operand__t.html">xed_encoder_operand_t</a>&#160;</td>
          <td class="paramname"><em>disp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Replace a relative/absolute branch displacement. </p>
<p>The widths of original displacement and replacement must match. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">xedd</td><td>A decoded instruction. </td></tr>
    <tr><td class="paramname">itext</td><td>The corresponding encoder output, byte array. </td></tr>
    <tr><td class="paramname">disp</td><td>A <a class="el" href="structxed__encoder__operand__t.html">xed_encoder_operand_t</a> object describing the new displacement. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>xed_bool_t 1=success, 0=failure </dd></dl>

</div>
</div>
<a id="gaf32817a117fdcb36ab6ba2962a89c069"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf32817a117fdcb36ab6ba2962a89c069">&#9670;&nbsp;</a></span>xed_patch_disp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="xed-common-hdrs_8h.html#a029d5ee2957ac2af5e2b75ec09f1daf9">XED_DLL_EXPORT</a> <a class="el" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> xed_patch_disp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__DEC.html#gacc9a7be76b242c5bf65f56036f5399e6">xed_decoded_inst_t</a> *&#160;</td>
          <td class="paramname"><em>xedd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">xed_uint8_t *&#160;</td>
          <td class="paramname"><em>itext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structxed__enc__displacement__t.html">xed_enc_displacement_t</a>&#160;</td>
          <td class="paramname"><em>disp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Replace a memory displacement. </p>
<p>The widths of original displacement and replacement must match. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">xedd</td><td>A decoded instruction. </td></tr>
    <tr><td class="paramname">itext</td><td>The corresponding encoder output, byte array. </td></tr>
    <tr><td class="paramname">disp</td><td>A <a class="el" href="structxed__enc__displacement__t.html">xed_enc_displacement_t</a> object describing the new displacement. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>xed_bool_t 1=success, 0=failure </dd></dl>

</div>
</div>
<a id="ga12f47e7d7f9998e9d8fd0d750aba54f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga12f47e7d7f9998e9d8fd0d750aba54f4">&#9670;&nbsp;</a></span>xed_patch_imm0()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="xed-common-hdrs_8h.html#a029d5ee2957ac2af5e2b75ec09f1daf9">XED_DLL_EXPORT</a> <a class="el" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> xed_patch_imm0 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__DEC.html#gacc9a7be76b242c5bf65f56036f5399e6">xed_decoded_inst_t</a> *&#160;</td>
          <td class="paramname"><em>xedd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">xed_uint8_t *&#160;</td>
          <td class="paramname"><em>itext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structxed__encoder__operand__t.html">xed_encoder_operand_t</a>&#160;</td>
          <td class="paramname"><em>imm0</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Replace an imm0 immediate value. </p>
<p>The widths of original immediate and replacement must match. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">xedd</td><td>A decoded instruction. </td></tr>
    <tr><td class="paramname">itext</td><td>The corresponding encoder output, byte array. </td></tr>
    <tr><td class="paramname">imm0</td><td>A <a class="el" href="structxed__encoder__operand__t.html">xed_encoder_operand_t</a> object describing the new immediate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>xed_bool_t 1=success, 0=failure </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
